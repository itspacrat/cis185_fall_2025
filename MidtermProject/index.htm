<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="styles/style.css">
    <link rel="icon" href="media/WikiCardsIcon-transparent.ico">
    <title>WikiCards Example Explorer</title>


</head>

<body>
    <div style="justify-content:center;text-align:center;">
        <img src="media/WikiCardsIcon-transparent.png" style="max-width:100px" />

        <h1>welcome to the WikiCard explorer</h1>


        <p>type a list of Wikipedia Titles separated by "|"...</p>
        <input type="text" name="entry" id="batchEntryBox"
            placeholder="Rock_hyrax|Malva_neglecta|Ferret-badger"></input>
        <button type="button" onclick="reloadBatch()">Get Cards</button>

        <div id="cardsRoot"></div>
    </div>
    <footer style="bottom:0;">
        <sub>
            <div>neither this project nor its developer are associated with MediaWiki or the WikiPedia team; all
                rights reserved.</div>
            <div>WikiCards icon by Blake G.</div>
        </sub>
    </footer>
</body>
<!-- script from project dir w/ function(s) + classes defined -->
<script src="scripts/page.js"></script>
<!-- inline script -->
<script>

    async function reloadBatch() {
        /*
        pretty much everything needs to be executed in the below scope, 
        as far as i can tell at least; you can't execute async code
        in a synchronous scope, which is what this <script> tag 
        initially uses
        */
        (async function () { // allow async execution with an IIFE

            let newCardRoot = document.createElement('div');
            newCardRoot.id = "cardsRoot";

            if (document.getElementById("batchEntryBox").value == "") {
                // Default to placeholder batch query
                batchStr = "" + document.getElementById("batchEntryBox").placeholder;
            } else {
                // if thers' a batch query submitted...
                batchStr = "" + escapeHtml(document.getElementById("batchEntryBox").value);
            }
            let BatchResponse = [];
            BatchResponse = await getCards("https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts&exintro=1&explaintext=true&titles=" + batchStr + "&formatversion=2&origin=*");

            console.log("cards:");
            console.log(BatchResponse);

            BatchResponse.forEach(element => {
                newCardRoot.append(element.toCard())
            });

            document.getElementById("cardsRoot").outerHTML = newCardRoot.outerHTML;
        })();
    }
    // on first load, use the placeholder text.
    reloadBatch();

</script>

</html>